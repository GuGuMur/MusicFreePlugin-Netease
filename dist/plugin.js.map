{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["import axios from \"axios\";\r\nimport CryptoJs = require(\"crypto-js\");\r\nimport qs = require(\"qs\");\r\nimport bigInt = require(\"big-integer\");\r\nimport dayjs = require(\"dayjs\");\r\nimport cheerio = require(\"cheerio\");\r\n\r\nconst headers = {\r\n    authority: \"music.163.com\",\r\n    \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36\",\r\n    \"content-type\": \"application/x-www-form-urlencoded\",\r\n    accept: \"*/*\",\r\n    origin: \"https://music.163.com\",\r\n    \"sec-fetch-site\": \"same-origin\",\r\n    \"sec-fetch-mode\": \"cors\",\r\n    \"sec-fetch-dest\": \"empty\",\r\n    referer: \"https://music.163.com/api/djradio/v2/get\",\r\n    \"accept-language\": \"zh-CN,zh;q=0.9\",\r\n};\r\nfunction a() {\r\n    var d,\r\n        e,\r\n        b = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\",\r\n        c = \"\";\r\n    for (d = 0; 16 > d; d += 1) (e = Math.random() * b.length), (e = Math.floor(e)), (c += b.charAt(e));\r\n    return c;\r\n}\r\n\r\nfunction b(a, b) {\r\n    var c = CryptoJs.enc.Utf8.parse(b),\r\n        d = CryptoJs.enc.Utf8.parse(\"0102030405060708\"),\r\n        e = CryptoJs.enc.Utf8.parse(a),\r\n        f = CryptoJs.AES.encrypt(e, c, {\r\n            iv: d,\r\n            mode: CryptoJs.mode.CBC,\r\n        });\r\n    return f.toString();\r\n}\r\n\r\nfunction c(text) {\r\n    text = text.split(\"\").reverse().join(\"\");\r\n    const d = \"010001\";\r\n    const e =\r\n        \"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7\";\r\n    const hexText = text\r\n        .split(\"\")\r\n        .map((_) => _.charCodeAt(0).toString(16))\r\n        .join(\"\");\r\n    const res = bigInt(hexText, 16).modPow(bigInt(d, 16), bigInt(e, 16)).toString(16);\r\n\r\n    return Array(256 - res.length)\r\n        .fill(\"0\")\r\n        .join(\"\")\r\n        .concat(res);\r\n}\r\n\r\nfunction getParamsAndEnc(text) {\r\n    const first = b(text, \"0CoJUm6Qyw8W8jud\");\r\n    const rand = a();\r\n    const params = b(first, rand);\r\n\r\n    const encSecKey = c(rand);\r\n    return {\r\n        params,\r\n        encSecKey,\r\n    };\r\n}\r\n\r\nfunction formatMusicItem(_) {\r\n    return {\r\n        id: _.mainSong.id,\r\n        artwork: _.coverUrl,\r\n        title: _.mainSong.name,\r\n        artist: _.mainSong.artists[0].name,\r\n        album: _.radio.name,\r\n        url: `https://music.163.com/song/media/outer/url?id=${_.mainSong.id}.mp3`,\r\n        qualities: {\r\n            standard: {\r\n                size: (_.mainSong.lMusic || {})?.size,\r\n            },\r\n        },\r\n        copyrightId: _?.copyrightId,\r\n    };\r\n}\r\nfunction formatAlbumItem(_) {\r\n    return {\r\n        id: _.id,\r\n        artist: _.dj.nickname,\r\n        title: _.name,\r\n        artwork: _.picUrl,\r\n        description: _.desc,\r\n        date: dayjs.unix(_.createTime / 1000).format(\"YYYY-MM-DD\"),\r\n    };\r\n}\r\n\r\nfunction musicCanPlayFilter(_) {\r\n    return _.feeScope === 0 || _.feeScope === 8;\r\n}\r\n\r\nconst pageSize = 30;\r\n\r\nasync function searchBase(query, page, type) {\r\n    const data = {\r\n        s: query,\r\n        limit: pageSize,\r\n        type: type, //1: 单曲, 10: 专辑, 100: 歌手, 1000: 歌单, 1002: 用户, 1004: MV, 1006: 歌词, 1009: 电台, 1014: 视频, 1018:综合, 2000:声音\r\n        offset: (page - 1) * pageSize,\r\n        csrf_token: \"\",\r\n    };\r\n    const pae = getParamsAndEnc(JSON.stringify(data));\r\n    const paeData = qs.stringify(pae);\r\n    const res = (\r\n        await axios({\r\n            method: \"post\",\r\n            url: \"https://music.163.com/weapi/search/get\",\r\n            headers,\r\n            data: paeData,\r\n        })\r\n    ).data;\r\n    return res;\r\n}\r\n\r\nasync function searchUserRadio(uid: number) {\r\n    const data = {\r\n        userId: uid,\r\n        csrf_token: \"\",\r\n    };\r\n    const pae = getParamsAndEnc(JSON.stringify(data));\r\n    const paeData = qs.stringify(pae);\r\n    const res = (\r\n        await axios({\r\n            method: \"post\",\r\n            url: \"https://music.163.com/weapi/djradio/get/byuser\",\r\n            headers,\r\n            data: paeData,\r\n        })\r\n    ).data;\r\n    return res;\r\n}\r\n\r\nasync function searchAlbum(query, page) {\r\n    const res = await searchBase(query, page, 1009);\r\n    const albums = res.result.djRadios.map(formatAlbumItem);\r\n    return {\r\n        isEnd: res.result.albumCount <= page * pageSize,\r\n        data: albums,\r\n    };\r\n}\r\n\r\nasync function searchArtist(query, page) {\r\n    const res = await searchBase(query, page, 1002);\r\n    const artists = [];\r\n    const userprofiles = res.result.userprofiles;\r\n    for (let i = 0; i < userprofiles.length; i++) {\r\n        const _ = userprofiles[i];\r\n        const albumSize = await searchUserRadio(_.userId);\r\n        artists.push({\r\n            name: _.nickname,\r\n            id: _.userId,\r\n            avatar: _.avatarUrl,\r\n            worksNum: albumSize.count,\r\n        });\r\n    }\r\n\r\n    return {\r\n        isEnd: res.result.artistCount <= page * pageSize,\r\n        data: artists,\r\n    };\r\n}\r\n\r\nasync function getArtistWorks(artistItem, page, type) {\r\n    if (type === \"music\") {\r\n        return {\r\n            isEnd: true,\r\n            data: [],\r\n        };\r\n    } else if (type === \"album\") {\r\n        const res = await searchUserRadio(artistItem.id);\r\n        return {\r\n            isEnd: true,\r\n            data: res.djRadios.map(formatAlbumItem),\r\n        };\r\n    }\r\n}\r\n\r\nasync function getLyric(musicItem) {\r\n    const data = { id: musicItem.id, csrf_token: \"\" };\r\n    const pae = getParamsAndEnc(JSON.stringify(data));\r\n    const paeData = qs.stringify(pae);\r\n    const result = (\r\n        await axios({\r\n            method: \"post\",\r\n            url: `https://music.163.com/api/dj/program/detail`,\r\n            headers,\r\n            data: paeData,\r\n        })\r\n    ).data;\r\n    return {\r\n        rawLrc: result.program.description,\r\n        translation: null,\r\n    };\r\n}\r\n\r\nasync function getAlbumInfo(albumItem) {\r\n    const data = {\r\n        radioId: albumItem.id,\r\n        csrf_token: \"\",\r\n        limit: pageSize,\r\n    };\r\n    const pae = getParamsAndEnc(JSON.stringify(data));\r\n    const paeData = qs.stringify(pae);\r\n    const res = (\r\n        await axios({\r\n            method: \"post\",\r\n            url: `https://music.163.com/weapi/dj/program/byradio`,\r\n            headers,\r\n            data: paeData,\r\n        })\r\n    ).data;\r\n    return {\r\n        musicList: (res.programs || []).filter(musicCanPlayFilter).map(formatMusicItem),\r\n    };\r\n}\r\n\r\nasync function getMediaSource(musicItem: IMusic.IMusicItem, quality: IMusic.IQualityKey) {\r\n    if (quality !== \"standard\") {\r\n        return;\r\n    }\r\n    return {\r\n        url: `https://music.163.com/song/media/outer/url?id=${musicItem.id}.mp3`,\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    platform: \"网易云电台\",\r\n    author: \"咕咕mur\",\r\n    version: \"0.0.1\",\r\n    srcUrl: \"https://fastly.jsdelivr.net/gh/GuGuMur/MusicFreePlugin-NeteaseRadio@master/dist/plugin.js\",\r\n    cacheControl: \"no-store\",\r\n    supportedSearchType: [\"album\", \"artist\"],\r\n    async search(query, page, type) {\r\n        if (type === \"album\") {\r\n            return await searchAlbum(query, page);\r\n        }\r\n        if (type === \"artist\") {\r\n            return await searchArtist(query, page);\r\n        }\r\n    },\r\n    getLyric,\r\n    getMediaSource,\r\n    getAlbumInfo,\r\n    getArtistWorks,\r\n};\r\n"],"names":[],"version":3,"file":"plugin.js.map"}